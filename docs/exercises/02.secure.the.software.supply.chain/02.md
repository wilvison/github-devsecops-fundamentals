# :test_tube: Versionamento

<!-- markdownlint-disable MD046 -->

!!! quote ":octicons-milestone-16: Motiva√ß√£o para Vers√µes"

    > Um pull request representa uma √∫nica agrega√ß√£o de m√∫ltiplas mudan√ßas significativas (ou seja, commits). Ao colaborar em escala em uma equipe ou projeto grande, pull requests direcionados ao branch padr√£o (produ√ß√£o) podem ser ainda mais protegidos por uma fila de mesclagem para valida√ß√£o adicional. Em qualquer caso, √© imperativo acompanhar as mudan√ßas agregadas introduzidas no branch padr√£o, que serve como fonte b√°sica para lan√ßamentos de produ√ß√£o.
    >
    > Algumas vers√µes podem eventualmente ser lan√ßadas, enquanto outras n√£o. Al√©m disso, uma vers√£o lan√ßada pode ser revertida para um lan√ßamento anterior conforme as decis√µes de neg√≥cios evoluem.

    ![Mostrar marco de versionamento](../../assets/img/milestone-versioning.png)

---

## Exerc√≠cio: Versionar Mudan√ßas Adicionadas ao Branch Principal

Versionamento Sem√¢ntico, `semver`, √© um esquema que transmite significado sobre o c√≥digo subjacente e o que foi modificado de uma vers√£o para a pr√≥xima.

A vers√£o `2.0.0` do `semver` √© oficialmente resumida da seguinte forma:

> Dado um n√∫mero de vers√£o MAJOR.MINOR.PATCH, incremente o:
>
> 1. N√∫mero de vers√£o MAJOR quando fizer mudan√ßas incompat√≠veis na API
> 1. N√∫mero de vers√£o MINOR quando adicionar funcionalidades de maneira compat√≠vel com vers√µes anteriores
> 1. N√∫mero de vers√£o PATCH quando fizer corre√ß√µes de bugs compat√≠veis com vers√µes anteriores
>
> R√≥tulos adicionais para pr√©-lan√ßamento e metadados de compila√ß√£o est√£o dispon√≠veis como extens√µes ao formato MAJOR.MINOR.PATCH.

Nesta fase fundamental da implementa√ß√£o de DevSecOps, aplicaremos o esquema `semver` e automatizaremos o incremento do patch. Existem conven√ß√µes que podem ser adotadas para automatizar igualmente o incremento nas vers√µes `MAJOR` e `MINOR`, mas para simplificar, nossa implementa√ß√£o pretendida assume o entendimento de que os aumentos de vers√£o `MAJOR` e `MINOR` ser√£o iniciados manualmente.

---

### **:material-numeric-1-circle: Implementar Versionamento de `PATCH`**

No explorador de arquivos, crie um novo fluxo de trabalho `.github/workflows/continuous.versioning.yml` da seguinte forma:

```yaml title=".github/workflows/continuous.versioning.yml" linenums="1" hl_lines="4-6 13-17 25-31 33-47 49-60"
--8<-- "reference.implementations/workflows/2.1.continuous.delivery.yml"
```

---

#### An√°lise

- **Linhas `4 - 6`**

    Somos introduzidos a um novo evento que encapsula a atividade de envio para branches espec√≠ficos, especificamente apenas o branch `main` nesta implementa√ß√£o.

- **Linhas `13 - 17`**

    Um GitHub App ser√° usado como o ator para as opera√ß√µes que executaremos. Portanto, a a√ß√£o `actions/create-github-app-token@v1` √© usada aqui para gerar um token de autoriza√ß√£o para o aplicativo.

    !!! question "O que √© um GitHub App?"
        GitHub Apps, muito _semelhantes_ a `contas de servi√ßo` e `bots`, s√£o ferramentas que estendem a funcionalidade do GitHub. Voc√™ pode criar um GitHub App para fornecer flexibilidade e reduzir atrito em seus processos, {== sem precisar fazer login como usu√°rio ou criar uma conta de servi√ßo ==}. GitHub Apps podem fazer coisas no GitHub como abrir issues, comentar em pull requests e gerenciar projetos. Eles tamb√©m podem fazer coisas fora do GitHub com base em eventos que acontecem no GitHub. Por exemplo, um GitHub App pode postar no Slack quando uma issue √© aberta no GitHub.

    O ator GitHub App ser√° usado posteriormente para fazer checkout do c√≥digo-fonte do reposit√≥rio e para enviar tags.

- **Linhas `25 - 31`**

    A etapa `Get last version number` (Obter √∫ltimo n√∫mero de vers√£o) calcula a √∫ltima vers√£o e a escreve na sa√≠da da etapa chamada `last_version`.

- **Linhas `33 - 47`**

    A etapa `Get new version number` (Obter novo n√∫mero de vers√£o) l√™ a sa√≠da da etapa anterior pela express√£o `${{ steps.get_last_version.outputs.last_version }}` e a usa para calcular o incremento do patch.

- **Linhas `49 - 60`**

    A etapa `Create tag for the new version` (Criar tag para a nova vers√£o) cria uma nova tag `git` para o lan√ßamento. Uma tag identifica pontos espec√≠ficos no hist√≥rico de um reposit√≥rio como sendo importantes. Aqui, a tag est√° sendo usada para marcar um ponto de lan√ßamento.

    Como existe um token de aplicativo persistente que ser√° usado no envio da tag, podemos ter confian√ßa de que o envio acionar√° efetivamente outras automa√ß√µes relevantes. Por outro lado, se o `GITHUB_TOKEN` padr√£o fosse usado, ele n√£o acionaria um fluxo de trabalho, pois {== **GitHub Actions corretamente protege contra o acionamento recursivo n√£o intencional de fluxos de trabalho** ==}.

---

### **:material-numeric-2-circle: Fazer commit e publicar suas altera√ß√µes**

!!! tip "Voc√™ pode vincular suas altera√ß√µes a uma issue"

    Lembre-se da issue que voc√™ criou anteriormente e seu respectivo n√∫mero, voc√™ o usar√° para vincular suas altera√ß√µes atuais √† issue.

```bash linenums="1"
git add .
git commit -m "$(printf 'Criar um jogo de tetris para impulsionar o engajamento do site\n\n-Implementar versionamento autom√°tico de patch\n\n- Resolve #<N√öMERO-DA-ISSUE>')"
git push origin feature/tetris-game
```

---

## üìö Recursos

- [Versionamento Sem√¢ntico 2.0.0](https://semver.org/)

---
