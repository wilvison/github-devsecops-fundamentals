# :test_tube: Lan√ßamento de Vers√£o

<!-- markdownlint-disable MD046 -->

!!! quote ":octicons-milestone-16: Lan√ßamento"

    > √Ä medida que fluxos de mudan√ßas chegam ao branch de _produ√ß√£o_ e s√£o versionados em lotes, uma parte essencial da entrega/implanta√ß√£o cont√≠nua √© produzir artefatos a partir de vers√µes que podem ent√£o ser implantados em v√°rios destinos.
    >
    > Lan√ßamentos s√£o itera√ß√µes de software implant√°veis que voc√™ pode empacotar e disponibilizar para um p√∫blico mais amplo baixar e usar.
    >
    > Como determinamos quando criar um lan√ßamento? Vamos ver...

    ![Mostrar marco de entrega de artefatos de pacote](../../assets/img/milestone-package-and-release-delivery-artifacts.png)

---

## Exerc√≠cio: Criar um Lan√ßamento de Vers√µes

Como voc√™ j√° pode imaginar, o GitHub fornece um evento que encapsula a atividade de criar uma tag e envi√°-la para um reposit√≥rio. Vamos automatizar o tratamento de tais eventos, para que possamos criar um lan√ßamento quando necess√°rio.

---

### **:material-numeric-1-circle: Implementar Cria√ß√£o de Lan√ßamento**

No explorador de arquivos, crie um novo fluxo de trabalho `.github/workflows/continuous.delivery.yml` da seguinte forma:

```yaml title=".github/workflows/continuous.delivery.yml" linenums="1" hl_lines="3-6 29-34 39-43 45-70 72-81 83-105"
--8<-- "reference.implementations/workflows/2.2.continuous.delivery.yml"
```

---

#### An√°lise

- **Linhas `3 - 6`**

    O fluxo de trabalho de cria√ß√£o de lan√ßamento ser√° acionado por envios de tags e quando a vers√£o da tag enviada tiver o sufixo de metadados `-release`.

- **Linhas `29 - 34`**

    Nos dois passos inclu√≠dos aqui, o site √© compilado e arquivado como um artefato de lan√ßamento.

- **Linhas `39 - 43`**

    Um GitHub App ser√° usado como o ator para as opera√ß√µes que executaremos. Portanto, a a√ß√£o `actions/create-github-app-token@v1` √© usada aqui para gerar um token de autoriza√ß√£o para o aplicativo.

    !!! question "O que √© um GitHub App?"
        GitHub Apps, muito _semelhantes_ a `contas de servi√ßo` e `bots`, s√£o ferramentas que estendem a funcionalidade do GitHub. Voc√™ pode criar um GitHub App para fornecer flexibilidade e reduzir atrito em seus processos, {== sem precisar fazer login como usu√°rio ou criar uma conta de servi√ßo ==}. GitHub Apps podem fazer coisas no GitHub como abrir issues, comentar em pull requests e gerenciar projetos. Eles tamb√©m podem fazer coisas fora do GitHub com base em eventos que acontecem no GitHub. Por exemplo, um GitHub App pode postar no Slack quando uma issue √© aberta no GitHub.

    > _Quando voc√™ usa o `GITHUB_TOKEN` do reposit√≥rio para executar tarefas, eventos acionados pelo `GITHUB_TOKEN`, com exce√ß√£o de workflow_dispatch e repository_dispatch, n√£o criar√£o uma nova execu√ß√£o de fluxo de trabalho. Isso evita que voc√™ crie acidentalmente execu√ß√µes de fluxo de trabalho recursivas. Por exemplo, se uma execu√ß√£o de fluxo de trabalho envia c√≥digo usando o `GITHUB_TOKEN` do reposit√≥rio, um novo fluxo de trabalho n√£o ser√° executado mesmo quando o reposit√≥rio cont√©m um fluxo de trabalho configurado para ser executado quando ocorrerem eventos de push._
    >
    > ~ [Usando o GITHUB_TOKEN em um fluxo de trabalho](https://docs.github.com/pt/actions/security-guides/automatic-token-authentication#using-the-github_token-in-a-workflow)

    Portanto, estamos autorizando opera√ß√µes como um GitHub App para permitir que a execu√ß√£o da opera√ß√£o acione ainda mais execu√ß√µes de fluxo de trabalho, possivelmente.

- **Linhas `45 - 70`**

    Um lan√ßamento `rascunho` √© criado pela respectiva etapa, permitindo a modifica√ß√£o do lan√ßamento antes de public√°-lo. O lan√ßamento faz refer√™ncia √† tag que acionou o fluxo de trabalho.

- **Linhas `72 - 81`**

    Esta etapa aproveita a API ReST do GitHub para ajustar o rascunho de lan√ßamento criado anteriormente, especificamente adicionando o arquivo arquivado criado na etapa `Archive Site` ao lan√ßamento como um ativo.

- **Linhas `83 - 105`**

    Tendo rascunhado o lan√ßamento e anexado ativos implant√°veis a ele, a etapa `Publish release` finalmente publica o lan√ßamento alterando o estado do atributo `draft` para `false`.

---

### **:material-numeric-2-circle: Fazer commit e publicar suas altera√ß√µes**

!!! tip "Voc√™ pode vincular suas altera√ß√µes a uma issue"

    Lembre-se da issue que voc√™ criou anteriormente e seu respectivo n√∫mero, voc√™ o usar√° para vincular suas altera√ß√µes atuais √† issue.

```bash linenums="1"
git add .
git commit -m "$(printf 'Criar um jogo de tetris para impulsionar o engajamento do site\n\n-Implementar automa√ß√£o de lan√ßamento\n\n- Resolve #<N√öMERO-DA-ISSUE>')"
git push origin feature/tetris-game
```

---

## üìö Recursos

- [Documenta√ß√£o do GitHub Apps](https://docs.github.com/pt/apps)
- [Documenta√ß√£o da API REST do GitHub](https://docs.github.com/pt/rest?apiVersion=2022-11-28)
- [GitHub Packages](https://docs.github.com/pt/packages/guides/about-github-container-registry)

---
